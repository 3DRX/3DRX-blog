---
title: "系统结构的基础"
description: "第一章"
pubDate: "06/02/2024"
updatedDate: "06/05/2024"
heroImage: ""
---

<!--toc:start-->
- [计算机系统的设计](#计算机系统的设计)
  - [Amdahl 定律](#amdahl-定律)
  - [CPU 性能公式](#cpu-性能公式)
- [计算机系统的性能评测](#计算机系统的性能评测)
<!--toc:end-->

## 计算机系统的设计

定量原理

### Amdahl 定律

$$
\begin{aligned}
S &= \frac{系统性能_{改进后}}{系统性能_{改进前}} = \frac{T_0}{T_n} \\
T_n &= T_0 (1-Fe + \frac{Fe}{Se}) \\
S &= \frac{T_0}{T_n} = \frac{1}{(1-Fe) + \frac{Fe}{Se}} \\
\end{aligned}
$$

- $T_0$: 总执行时间-改进前
- $T_n$: 总执行时间-改进后
- $S$: 加速比
- $Fe$: 在改进前的系统中，可改进部分的执行时间在总时间中的占比
- $Se$: 改进前所需执行时间与改进后所需执行时间的比

对于多部件的系统

$$
S = \frac{1}{(1 - \sum F_i) + \sum \frac{F_i}{S_i}}
$$

### CPU 性能公式

CPU 时间 = 执行程序所需的时钟周期数 * 始终周期时间

CPI: Cycles Per Instruction

CPI = 执行程序所需的时钟周期数 / 所执行的指令条数

CPU 时间 = 指令数 * CPI * 时钟周期时间

## 计算机系统的性能评测

不同计算机系统执行不同程序的性能会有所不同，有 3 种方法解决这一问题。
1. 对比总执行时间
2. 对比调和平均值：$\frac{n}{\sum\limits_{i=1}^n \frac{1}{x_i}}$
3. 对比几何平均值：$(\prod\limits_{i=1}^nx_i)^{\frac{1}{n}}$

## 题目

### 1.7

某台主频为 400 MHz 的计算机执行标准测试程序，程序中指令类型、执行数量和平均时钟周期数如下

| 指令类型 | 指令执行数量/条 | 平均时钟周期数 |
| :----: | :--------: | :-------: |
| 整数   | 45 000   | 1       |
| 浮点   | 8 000    | 4       |
| 数据传送 | 75 000   | 2       |
| 分支   | 1 500    | 2       |

求该计算机的有效 CPI、MIPS 和程序执行时间。

$$
\begin{aligned}
CPI &= \frac{45000 \times 1 + 8000 \times 4 + 75000 \times 2 + 15000 \times 2}
{45000 + 8000 + 75000+ 15000}
= \frac{257,000}{143,000} = 1.0979020979
\\
MIPS &= \frac{400M}{CPI} = 222.5680933852
\\
执行时间 &= \frac{45000 \times 1 + 8000 \times 4 + 75000 \times 2 + 15000 \times 2}
{400MHz} = \frac{257,000}{400,000} = 0.6425 (秒)
\end{aligned}
$$

### 1.10

有三个部件可以改进，加速比如下
- $S_1 = 30$
- $S_2 = 20$
- $S_3 = 10$

1. 如果部件 1 和部件 2 的可改进比例都为 30%，那么当部件 3
的可改进比例为多少时，系统的加速比才可以达到 10？

    $$
    \begin{aligned}
    S &= \frac{1}{1 - (0.3 + 0.3 + F_3) + \frac{0.3}{30} + \frac{0.3}{20} + \frac{F_3}{10}} \\
    &\approx 0.361
    \end{aligned}
    $$

2. 如果三个部件的可改进比例分别为 30%, 30% 和 20%，三个部件同时改进，
那么系统中不可改进部分的执行时间在总时间中占比多少？

    令原系统总时间为 $T_0$，则不可改进部分时间为 $(1-0.3-0.3-0.2)T_0 = 0.2T_0$，
    改进后总时间为 $0.2T_0 + (0.3/30 + 0.3/20 + 0.2/10)T_0 = 0.245T_0$，两者的比值即为答案。

### 1.11

FP 指令的比例为 30%，其中 FPSQR 站全部指令的比例为 4%，FP 操作的 CPI 为
5，FPSQR 操作的 CPI 为 20，其他指令的平均 CPI 为 1.25。现有两种改进方案，
第一种是把 FPSQR 操作的 CPI 减至 3，第二种是把所有 FP 的 CPI 减至 3，
试比较两种对整体性能的提升。

优化前整体：30% * 5 + 4% * 20 + (1 - 34%) * 1.25 = 3.25  
第一种优化后：30% * 5 + 4% * 3 + (1 - 34%) * 1.25 = 2.445  
第二种优化后：30% * 3 + 4% * 20 + (1 - 34%) * 1.25 = 2.525
