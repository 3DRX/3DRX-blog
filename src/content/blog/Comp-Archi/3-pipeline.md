---
title: "流水线"
description: "第三章"
pubDate: "06/03/2024"
updatedDate: "06/03/2024"
heroImage: ""
---

## 分类

1. 部件级、处理机级、系统级
2. 单功能与多功能
3. 静态与动态
4. 线性与非线性
5. 顺序与乱序

## 性能指标

### 吞吐率

- $TP$: 吞吐率，单位时间内流水线所完成的任务数量或输出结果数量
- $\Delta t_n$: 第 $n$ 段所需时间

各段时间不等的流水线的**实际**吞吐率为

$$
TP = \frac{n}{\sum_{i=1}^k \Delta t_i + (n-1)max(\Delta t_1, \Delta t_2, ..., \Delta t_k)}
$$

**最大**吞吐率为

$$
TP_{max} = \frac{1}{max(\Delta t_1, \Delta t_2, ..., \Delta t_k)}
$$

#### 优化性能

消除瓶颈段
1. 细分瓶颈段，使瓶颈段不再是最慢的一段
2. 重复设置瓶颈段

### 加速比

- $T_s$: 顺序执行所用的时间
- $T_k$: 按流水线方式处理所用的时间

理论加速比
$$
S = \frac{T_s}{T_k}
$$

实际加速比：若各段时间相同，一条 $k$ 段流水线完成 $n$ 个连续任务
$$
S = \frac{nk}{k+n-1}
$$
这种情况下，最大加速比为
$$
S_{max} = \lim_{n\rightarrow \infty}\frac{nk}{k+n-1} = k
$$

流水线各段时间不等时，实际加速比为
$$
S = TP \times \sum_{i=1}^k \Delta t_i
$$

### 效率

> 流水线的效率指流水线设备的利用率

如果各段时间相等，则
$$
e_1 = e_k = \frac{n\Delta t}{T_k} = \frac{n}{k+n-1}
$$
整条流水线效率为
$$
E = \frac{\sum_{i=0}^k e_i}{k}
$$

## 相关与冲突

举例：经典 5 段流水线
1. 取指 IF
2. 指令译码 / 读寄存器 ID
3. 执行 / 有效地址计算 EX
4. 存储器访问 / 分支完成 MEM
5. 写回 WB

### 相关

两条指令之间存在某种依赖关系，在流水线中不能重叠或只能部分重叠。
1. 数据相关：后面的指令依赖前面的指令产生的结果，且这种关系可传递。
2. 名相关：“名” 指存储器或存储单元名称，名相关是两条指令使用相同的名，
但并没有数据流动。
    1. 反相关：两条指令所读的名相同
    2. 输出相关：两条指令所写的名相同
3. 控制相关：分支内的指令与条件判读指令之间的相关。
